---
tags:
  - NETWORKING
curso: Ciência da computação
---
## O protocolo HTTP
A internet começou a se popularizar em 1990 e com isso, era muito comum ver programas de televisão e empresas divulgarem seus sites, que sempre vinham com um formato chamado de *URL - Localizador Uniforme de Recursos*. 

###### exemplo
> http://meusite.com.br
> 
 O URL desse exemplo começa com "**http://**", que indica ao navegador (chrome, firefox, etc) que o acesso deverá ser feito usando o protocolo de aplicação HTTP.

O protocolo HTTP foi criado no início dos anos 1990, como parte de um esforço para simplificar a troca de informações pela internet. Esse esforço rendeu um conjunto de soluções e ferramentas. Foi criada uma linguagem para a formatação de textos e com a possibilidade de navegação entre conteúdos, o chamado **hipertexto**. Essa linguagem recebeu o nome de **HTML**.

Também foi necessário criar *programas para fornecer conteúdos, do lado do servidor (web servers) e para visualizar o conteúdo no computador cliente (browsers ou navegadores). Obviamente, se esses dois programas conversam, foi necessário definir as regras para essa conversa: como devem ser os pedidos e as respostas.* Essas regras são o que chamamos de **protocolo**, e para esse conjunto de soluções foi criado o protocolo **HTTP**.

Uma característica importante do HTTP é que ele permite transmitir diversos tipos de conteúdo, aqui chamados de **objetos**: texto, imagens, vídeos, arquivos em geral.

> O TCP oferece um serviço confiável fim a fim, providenciando a retransmissão de pacotes de dados perdidos ou recebidos com erro. Ainda se encarrega de ajustar o tráfego às condições da rede e das estações participantes. Assim, o protocolo HTTP e as aplicações ficam dispensados de tomar esses cuidados que o TCP proporciona.
> 
> **A porta padronizada para o HTTP é a 80**, sendo possível usar qualquer outra desde que explicitada no URL. A conexão é sempre iniciada pelo cliente (navegador web) ao servidor web.


#### Como ocorrem as interações do protocolo HTTP?
As interações do protocolo HTTP seguem uma sequência: **mensagem de requisição** (pelo cliente) e **mensagem de resposta** (pelo servidor).

![[Pasted image 20240904192437.png]]

Uma característica importante do HTTP é que as requisições e respostas são escritas como um texto comum, usando palavras e expressões do idioma inglês. Isso nos permite olhar a comunicação e entender de imediato o que está acontecendo.

As mensagens de **requisição** seguem o formato:
LINHA DE REQUISIÇÃO
LINHAS DE CABEÇALHO
Linha sem conteúdo
CORPO DA ENTIDADE (nem sempre usado)

A linha de requisição sempre começa com um **método**, que indica a ação que está sendo requisitada. As linhas de cabeçalho podem ser incluídas para carregar informações adicionais na mensagem de requisição. O corpo da entidade é usado quando o cliente precisa enviar dados ao servidor – por exemplo, quando preenchemos um formulário e esses dados estão sendo enviados para o servidor.

```http
GET / HTTP/1.1
Host: meusite.com.br
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:88.0) Gecko/20100101 Firefox/88.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Encoding: gzip, deflate
```

No exemplo anterior, temos na linha de requisição o método GET, usado quando o cliente deseja requisitar algum conteúdo. Ele é seguido pelo recurso que está sendo solicitado. No exemplo, o caractere “/” representa a raiz de um site, ou seja, a página principal. Mas poderia ter sido indicado um nome específico de conteúdo, como uma imagem ou outra página em HTML (/imagem.jpg ou /pagina.html). A linha de requisição termina com a indicação da versão do protocolo HTTP (1.1) que está sendo usada pelo navegador.

O HTTP prevê outros métodos, além do GET. Um deles é o POST, usado quando o cliente precisa enviar dados para o servidor – como exemplificado anteriormente, no caso do preenchimento de um formulário.

Após a linha de requisição, as linhas que seguem são de cabeçalho e carregam informações adicionais à requisição. A primeira delas, muito importante, informa qual o nome do site que está sendo acessado.

Nas demais linhas, o cliente informa qual o programa (agente de usuário) está sendo usado (versão do navegador, sistema operacional), os tipos de conteúdo esperados e as codificações aceitas.

As mensagens de **resposta** seguem o formato:
LINHA DE ESTADO
LINHAS DE CABEÇALHO
Linha sem conteúdo 
CORPO DA ENTIDADE (dados/conteúdo requisitados)

```http
HTTP/1.1 200 OK
Date: Thu, 06 May 2021 17:54:22 GMT
Server: Apache
Last-Modified: Tue, 04 May 2021 14:22:05 GMT
Content-Length: 149495
Content-Type: text/html; charset=UTF-8
(linha sem conteúdo) / Separa o cabeçalho do conteúdo
CONTEÚDO DA RESPOSTA
No caso deste exemplo seria um texto no formato HTML, informação declarada no cabeçalho ‘Content-Type’ acima.
```

A primeira linha (linha de estado) fornece três informações importantes: A  **versão do protocolo HTTP usada**, o **código de estado** (status code) e a **frase explicativa** (reason phrase).

*O código de estado é sempre um número de três dígitos*, que indica o resultado obtido para a requisição. A frase explicativa é um texto voltado para pessoas contendo informações sobre o resultado obtido para a requisição.

#### Códigos de estado
O primeiro dígito do código de estado indica o tipo de resultado obtido, como indicado a seguir:
* **1XX**: Informação. Requisição recebida, ainda sendo processada.
* **2XX**: Sucesso. A requisição foi corretamente recebida e processada.
* **3XX**: Redirecionamento. O cliente deverá tomar outra ação para concluir a requisição.
* **4XX**: Erro do cliente. A requisição é inválida ou não pode ser atendida.
* **5XX**: Erro do servidor. O servidor falhou ao processar uma requisição válida.

Alguns códigos de estado bem conhecidos são:
* **200**: OK. Indicando que o processamento da requisição foi bem-sucedido.
* **404**: Recurso não encontrado. Quando o cliente solicita um recurso que não existe no servidor.
* **500**: Erro interno do servidor. Quando o servidor enfrenta um erro crítico ao processar uma requisição.

#### Entendendo o que há por trás do conteúdo
Quando fazemos uma requisição ao servidor por um recurso, precisamos entender o que pode acontecer em seguida. As duas situações mais comuns são:
* **Conteúdo estático**: O conteúdo está em um arquivo armazenado no servidor, que será enviado ao cliente. Esse conteúdo é chamado de estático, pois ele não é criado ou formatado no momento da requisição. Para mudá-lo, um administrador deve modificar o arquivo no servidor. Nessa categoria estão páginas, imagens, arquivos de formato etc.
* **Conteúdo dinâmico**: Ao receber a requisição, o servidor executará um programa que irá gerar o conteúdo para o cliente. Esse conteúdo é chamado de dinâmico, pois é gerado na hora e pode variar conforme a requisição. É o caso de sites como webmail ou redes sociais, em que o conteúdo é personalizado para quem fez a requisição.

#### HTTP com conexões persistentes
Para aumentar o desempenho, reduzindo o tempo total necessário para baixar os recursos, o protocolo HTTP prevê o modo de operação persistente. Nele, a *conexão TCP permanece ativa após uma resposta, estando pronta para transferir uma nova requisição imediatamente*. A conexão TCP será encerrada quando o cliente não tiver mais requisições a fazer, ou pelo servidor, após um período sem atividade.

![[Pasted image 20240904203217.png]]

#### URL – Uniform Resource Locator
Um URL completo, com todos os dados possíveis, teria um formato assim:

*protocolo://hospedeiro:porta/caminho/recurso*

* **PROTOCOLO**: É o protocolo de aplicação que deverá ser usado para realizar o acesso ao servidor hospedeiro. Por exemplo: http.
* **HOSPEDEIRO**: É o endereço do servidor a ser acessado. Pode ser um endereço IP (IPv4 ou IPv6) ou um nome. No último caso, o navegador deverá realizar a tradução do nome pelo serviço de DNS, antes de iniciar a conexão.
* **PORTA**: É um campo opcional, indicando explicitamente a porta (protocolo TCP) que deverá ser usada. Quando não especificado, é usada a porta padrão do protocolo. No caso do HTTP, a porta padrão é a 80.
* **CAMINHO E RECURSO**: É a localização do recurso no servidor, semelhante a uma estrutura de diretórios, facilitando a organização do conteúdo. O caminho pode ser composto por nenhum ou até por vários nomes.

### HTTPS
Não é tarefa do HTTP garantir a segurança dos dados trafegados. Qualquer pessoa que consiga capturar os pacotes de uma conversa HTTP terá acesso completo aos dados trafegados. O protocolo HTTP não tem recursos para impedir um ataque em que o conteúdo da comunicação é maliciosamente modificado durante seu trânsito, entre origem e destino.

Para resolver essas questões e conferir segurança ao protocolo HTTP, foi criado, em 1994, o HTTPS. Em vez de criar um protocolo, o HTTPS foi definido como **uma extensão do HTTP**, contendo mecanismos para garantir a confidencialidade e a integridade dos dados transmitidos.

![[Pasted image 20240904203651.png]]


#### Mas, como o HTTPS funciona?
A segurança é obtida utilizando mecanismos de criptografia simétrica e assimétrica, e hashing para assinatura digital. O HTTPS também utiliza certificados digitais, assinados por autoridades certificadoras externas. Assim, é possível também impedir que alguém crie um site falso usando o nome ou endereço de alguma empresa ou entidade.

O HTTPS funciona com uma subcamada, abaixo do HTTP, em que todas as informações são protegidas antes de serem enviadas para a camada de transporte; no receptor, a operação inversa é feita nos dados enviados pela camada de transporte. Essa subcamada é composta por um mecanismo SSL (Secure Socker Layer) ou, mais recentemente, TLS (Transport Layer Security).

![[Pasted image 20240904204011.png]]

Fora da subcamada de segurança, a troca de mensagens no HTTPS é exatamente a mesma do HTTP, seguindo as mesmas regras.

****
****
## Protocolo FTP
Antes do HTTP, o principal protocolo para a transferência de arquivos na internet era o FTP. Por ser dedicado à transferência de arquivos, seu funcionamento é diferente em comparação com o HTTP, porém também utiliza o protocolo de transporte TCP.

O FTP trabalha com uma conexão persistente, a conexão de controle, pela qual um usuário interage com o servidor, enviando comandos para navegação entre diretórios, lista seu conteúdo e inicia transferências de arquivo – GET (do servidor para o cliente) e PUT (do cliente para o servidor).

**A porta padrão do servidor FTP para a conexão de controle é a 21.**

#### Conexões do protocolo FTP
Ao estabelecer a conexão de controle, o servidor envia uma saudação com uma mensagem que pode ser personalizada pelo administrador. Em seguida, é necessário se autenticar por meio de login e senha.

Uma vez autenticado o usuário, a conexão de controle permanece ativa. Para qualquer transferência de arquivos, uma nova conexão será iniciada, a **conexão de dados**, que será encerrada imediatamente após o término da transmissão.

![[Pasted image 20240904204606.png]]


##### Uma diferença importante na operação dos protocolos FTP e HTTP é apresentada a seguir:
* **FTP**: Utiliza o **controle fora da banda**, pois separa em conexões distintas os comandos e transferências.
* **HTTP**: Utiliza o **controle na banda**, pois usa a mesma conexão para comandos e transferências.

##### Modos de operação – ativo e passivo
Um ponto importante e que todo profissional de TI deve conhecer, são os dois **modos** para estabelecer as conexões de dados pelo FTP:


| Modo ativo                                                                                                                                                                                                                                                                                                                                                                                                                                       | Modo passivo                                                                                                                                                                                                                                                                                                                                                                        |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| A conexão de dados é iniciada **pelo servidor** ao cliente, com porta de origem 20. Ou seja, para iniciar uma transferência, o cliente deve abrir uma porta e aguardar que o servidor se conecte a ela.<br><br>O grande problema desse modo é que atualmente grande parte dos terminais acessa a internet com tradução de endereço (NAT – Network Address Translation) ou está em redes protegidas por firewalls, que impedem conexões externas. | Nos casos de dificuldade de uso do modo ativo, a solução é utilizar o modo passivo, em que a conexão é iniciada pelo cliente para o servidor em uma porta diferente da porta de controle.<br><br>Para usar o modo passivo, o cliente envia ao servidor, na conexão de controle, o comando PASV e recebe como resposta um endereço IP e porta na qual a conexão deverá ser iniciada. |

![[Pasted image 20240904205011.png]]

****
****

## Protocolo TELNET
**O principal objetivo do protocolo de aplicação TELNET é permitir o acesso remoto a terminais através da internet**. Por meio dele, um usuário pode se conectar a um computador remotamente e ter a mesma experiência que utilizando o terminal desse computador presencialmente.

O TELNET é voltado apenas para terminais baseados em texto, ou seja, transferindo somente dados de caracteres. Logo, o TELNET não permite, por exemplo, acesso a um ambiente gráfico ou o uso de mouse para interação. Essa característica tornou o TELNET uma opção ideal para o acesso a sistemas baseados em texto como o shell, estações baseadas em UNIX e para consoles de gerência de equipamentos de rede, como roteadores, switches etc.

**O TELNET usa a porta 23 como padrão.**
##### Interação com o servidor TELNET
O TELNET utiliza o protocolo de transporte TCP, que garante a confiabilidade na entrega dos pacotes.

O TELNET funciona da seguinte forma:
* Quando um cliente TELNET se conecta a um servidor, é criado um canal de comunicação bidirecional, em que ambos podem enviar e receber dados.
* Como o objetivo do TELNET é oferecer ao usuário uma experiência semelhante ao uso presencial, cada vez que o usuário pressiona uma tecla essa informação é imediatamente enviada ao servidor.
* O cliente não aguarda a digitação de um comando completo para enviá-lo. Na verdade, o cliente não tem conhecimento sobre os comandos digitados ou suas estruturas. Por outro lado, cada informação recebida pelo cliente é imediatamente exibida no terminal do usuário.
* O cliente TELNET sequer exibe no seu próprio terminal as teclas digitadas pelo usuário. Para que isso aconteça, o servidor deverá enviar de volta o texto digitado para o cliente, uma operação chamada ECO. Assim, o servidor tem o controle sobre o que será exibido no terminal do cliente.


O protocolo TELNET não possui mecanismos de autenticação de usuário. Qualquer solicitação de identificação ou senha é transmitida e respondida como um texto comum. Muitos sistemas, apesar de não recomendado, permitiam o acesso ao seu terminal sem autenticação. Nesses casos, o terminal de comandos do servidor estava imediatamente disponível após a conexão do usuário

##### Segurança
Atualmente, o protocolo TELNET está em desuso e é extremamente desaconselhável utilizá-lo na internet. A razão para isso é a falta de segurança. Toda a comunicação é transmitida em texto claro, ou seja, sem qualquer tipo de criptografia que impeça a captura de seus dados, inclusive senhas. A alternativa para acesso remoto atualmente é o protocolo SSH (Secure Shell Protocol), que possui criptografia e autenticação integrada.

****
****

## Protocolos de correio eletrônico
Um dos serviços mais antigos e mais usados na internet é o correio eletrônico (e-mail).  O correio eletrônico é baseado em uma estrutura simples de serviços e protocolos, responsáveis pelas seguintes tarefas: 

RECEPÇÃO >> EFILEIRAMENTO >> ENCAMINHAMENTO >> ARMAZENAMENTO >> RESGATE DE MENSAGENS

### Protocolo SMTP
O próprio formato do endereço de e-mail já nos mostra a estruturação hierárquica do serviço de correio. O endereço é composto de duas partes, separadas pelo caractere @. A segunda parte corresponde ao domínio, enquanto a primeira é a parte local, a identificação do usuário dentro do domínio.

![[Pasted image 20240904210006.png]]


A sequência mais simples de passos ocorre do seguinte modo:

1.  **Cliente se conecta ao servidor**
O cliente de correio do João se conectará ao servidor de correio da sua própria empresa (empresa X). Esse servidor é o responsável por receber as mensagens enviadas pelos endereços da empresa.

2. **Servidor recebe a mensagem**
O servidor da empresa X receberá a mensagem e a armazenará em uma área temporária. Será feita uma análise do destinatário da mensagem. O servidor da empresa X determinará o endereço do servidor de destino, ou seja, da empresa Y.

3. **Conexão entre servidores**
O servidor da empresa X se conectará ao servidor da empresa Y e enviará a mensagem a ele.

4. **Servidor do destino recebe a mensagem**
O servidor da empresa Y receberá a mensagem e a armazenará a mensagem na caixa de mensagens daquele usuário.

![[Pasted image 20240904210226.png]]

Repare que o último item é semelhante a uma caixa de correio física, como usado em muitos prédios. As mensagens recebidas são colocadas nessa caixa e, posteriormente, o destinatário precisará acessar sua caixa para receber o que está ali armazenado.

As etapas 2 e 4 ocorreram nos servidores como tarefas internas. Porém, nas etapas 1 e 3 ocorreu transmissão através da rede. E essas duas etapas têm em comum o protocolo de aplicação usado para a transmissão da mensagem: o **SMTP (Simple Mail Transport Protocol)**.

*O SMTP atua como um agente de transmissão de mensagens (MTA – Mail Transfer Agent), tornando possível o envio da mensagem do remetente, até chegar à caixa postal do destinatário. O protocolo SMTP utiliza o protocolo de transporte TCP, sua porta padrão é a 25 e emprega um modelo cliente-servidor, com a conexão TCP sempre iniciada pelo cliente.*

###### O que precisa ser feito para que a conexão ocorra?
Antes de se conectar ao servidor do destinatário, é preciso determinar qual o endereço IP desse servidor. Para isso, o servidor da empresa X buscará no serviço de DNS o registro do tipo MX do domínio empresay.com.

Uma vez que o endereço foi determinado, o servidor passa à etapa 3. Uma conexão SMTP é iniciada no endereço do servidor de destino.

#### Mensagens do protocolo SMTP
Toda a conversa pelo protocolo SMTP, desde a negociação inicial até o término da transmissão da mensagem, será feita com caracteres de texto. Portanto, assim como vimos no HTTP, se o tráfego for capturado será possível observar com facilidade toda a comunicação.


As respostas do servidor são sempre iniciadas com um código numérico de três dígitos, o status code, semelhante ao HTTP. Resumidamente, se o código de for iniciado com:

* **2XX**: Resposta positiva, a solicitação foi feita com sucesso.
* **3XX**: A solicitação foi recebida com sucesso, porém, aguarda alguma pendência para ser concluída.
* **4XX**: Erro ao processar a solicitação, por uma condição temporária. O cliente deverá repetir a solicitação posteriormente.
* **5XX**: Erro ao processar a solicitação. O cliente **não** deve repetir a solicitação.

Os programas que usam o protocolo SMTP baseiam seu funcionamento somente nas respostas numéricas. O texto posterior serve para auxiliar no diagnóstico de problemas pelos administradores do sistema.

``` SMTP
(01) `S: 220 mailserver.empresay.com ESMTP Postfix`  
(02) `C: EHLO mailserver.empresax.com`  
(03) `S: 250-SIZE 1048576`  
(04) `C: MAIL FROM:<joao@empresaX.com>`  
(05) `S: 250 Ok`  
(06) `C: RCPT TO:<maria@empresaY.com>`  
(07) `S: 250 Ok`  
(08) `C: DATA`  
(09) `S: 354 End data with <CR><LF>.<CR><LF>`  
(10) `C: From: "Joao Silva" <joao@empresax.com>`  
(11) `C: To: “Maria Souza” <maria@empresay.com>`  
(12) `C: Date: Tue, 18 May 2021 12:03:15 -0300`  
(13) `C: Subject: Confirmação`  
(14) `C:``(linha sem conteúdo enviada pelo cliente, para separar cabeçalho do corpo da mensagem)`  
(15) `C: Olá, Maria.`  
(16) `C: Confirmo que recebi seu pedido.`  
(17) `C: Atenciosamente,`  
(18) `C: João.`  
(19) `C: .`  
(20) `S: 250 Ok: queued as 1F8C5A549`  
(21) `C: QUIT`  
(22) `S: 221 Bye`
```

Vamos analisar uma conversa SMTP:
1. Logo após o estabelecimento da conexão TCP, o servidor envia uma saudação, seguindo o código 220 que significa “estou pronto” (linha 1).

2. Em seguida, o cliente se identifica com o comando EHLO. O servidor responde com informações sobre opções ou recursos disponíveis. Nesse exemplo, foi informado somente o tamanho máximo de mensagem aceita pelo servidor. Se a mensagem a ser enviada fosse maior que esse limite, o cliente deveria interromper o envio e reportar ao remetente a impossibilidade de transmissão (linhas 2 e 3).

3.  Continuando, o cliente declara o remetente (MAIL FROM) e os destinatários da mensagem, nesse caso, apenas um destinatário. Se fossem mais destinatários para aquele servidor (@empresay.com), o comando RCPT TO: seria repetido para cada um deles (linhas 4 a 7).

4. Em seguida, o cliente usa o comando DATA para começar o envio da mensagem. O servidor responde que ele deve começar a enviar o conteúdo e sinalizar o término, enviando uma linha apenas com um ponto (linhas 8 e 9).


5. A mensagem é enviada. Repare que ela é dividida em duas partes, separadas por uma linha sem conteúdo (linha 14). A primeira parte, é chamada de CABEÇALHO (linhas 10 a 13). É onde são declaradas as informações daquela mensagem, como remetente, destinatários, cópia aberta, assunto, data e hora do envio etc. A segunda parte é o corpo, que corresponde ao texto da mensagem (linhas 15 a 18).

6. A linha 19 (apenas com um caractere “ponto”) indica o término da mensagem ao servidor.

7. O servidor responde com código 250, para indicar operação bem-sucedida (linha 20).

8. Terminada a transmissão, o cliente envia um comando QUIT e o servidor encerra a conexão TCP (linhas 21 e 22).

O SMTP define que o trecho até a linha 9 é chamado de **envelope**, enquanto o restante é chamado de **conteúdo**.

Nesse exemplo, o RCPT TO: (linha 6) teve respostas com código 250, que indica sucesso da requisição. Se o destinatário estivesse com a caixa de mensagens lotada, o código seria um erro 450, e o cliente deveria tentar o envio posteriormente.

Se o destinatário não existisse, por exemplo, a resposta seria um código 550. Nesse caso, o servidor deveria descartar a mensagem e enviar uma notificação ao remetente. Nas notificações, o texto recebido com o código 550 costuma ser incluído, o que ajuda no diagnóstico do problema.

#### Necessidade de autenticação no protocolo SMTP
Já vimos a transmissão na etapa 3, entre os servidores. Porém, ainda falta falarmos da etapa 1, entre o cliente, no computador de João, e o servidor da empresa X. A conversa com o protocolo SMTP é praticamente a mesma, mas há uma consideração de segurança importante.

O servidor X recebe a mensagem enviada pelo cliente de João e a retransmite para o servidor de destino. Imagine que o servidor X seja plenamente acessível na internet para qualquer usuário, e não somente para quem realmente trabalha na empresa X. Esse servidor seria um alvo fácil para pessoas que desejam transmitir SPAM e para tentativas de golpe usando o servidor da empresa X.

Para isso, foram criadas extensões no protocolo SMTP para exigir a autenticação dos usuários. Alguns dos procedimentos de segurança estão listados a seguir:

* A autenticação é, quase sempre, realizada por meio de senha pessoal.
* O servidor somente retransmitirá uma mensagem para outro servidor se ela tiver sido recebida de um usuário devidamente autenticado.
* O cliente utiliza funções de hashing para enviar a senha ao servidor, impedindo que ela seja interceptada mesmo quando a comunicação não é criptografada.

#### Uso de criptografia com o protocolo SMTP
Atualmente, a grande maioria das comunicações SMTP é feita com o uso de criptografia, protegendo toda a comunicação, inclusive o conteúdo das mensagens, de captura por terceiros.

Sobre isso, a escolha da porta a ser usada depende do tipo de conexão:
* **CLIENTE-SERVIDOR**: Nos dias atuais, é amplamente recomendado que se utilize a porta **587/TCP** para as conexões dos clientes de usuário aos servidores para a transmissão de mensagens, com o uso obrigatório de criptografia e autenticação. A porta 587 é conhecida como **submission port**.
* **SERVIDOR-SERVIDOR**: Entre servidores, é usada somente a porta 25, e se ambos suportarem a camada de segurança TLS (Transport Layer Security), ela poderá oferecer criptografia e segurança por meio de certificados digitais.

#### Cabeçalho Received nos e-mails
Todas as vezes em que uma mensagem é recebida e retransmitida por um servidor de correio, ele inclui uma linha no início do cabeçalho que começa com RECEIVED:. Esse cabeçalho oferece um registro do caminho percorrido pela mensagem, de servidor para servidor, permitindo rastreá-la. Nela, estão incluídas informações sobre cada vez que foi retransmitida, como servidor de origem e destino, data e hora.

### Protocolos POP3 e IMAP – resgatando mensagens no servidor
Até agora, vimos o protocolo SMTP funcionando como um carteiro que entrega uma carta na caixa de correio de uma casa. Porém, para essa carta chegar ao seu destinatário, ele deverá abrir essa caixa e resgatar as cartas armazenadas. No correio eletrônico, essa lógica é a mesma e, para essa função, estudaremos dois protocolos de resgate de mensagens:

*  **POP (Post Office Protocol)**
Porta padrão: 110
Versão mais recente (no momento da confecção deste material): POP3 (terceira versão)

* **IMAP (Internet Message Access Protocol)**
Porta padrão: 143
Versão mais recente (no momento da confecção deste material): IMAP4 (quarta versão)

Os protocolos POP e IMAP também podem ser chamados de agentes de acesso a mensagens (MAA – Mail Agent Access), ambos utilizam o protocolo de transporte TCP.

Assim como você usa uma chave para as caixas de correio de casa, para acessar a sua caixa no servidor será necessária uma autenticação, por meio de senha pessoal. Após a autenticação, o conteúdo fica disponível para ser lido, apagado ou modificado. Mas as semelhanças entre o POP e o IMAP param por aqui.

#### Características do protocolo POP
O POP, mais antigo, tem poucos recursos e se adequava bem às limitações da internet na época em que foi criado. Em linhas gerais, as etapas seguidas são:

O cliente se conecta ao servidor >> o cliente é autenticado >> cliente obtém a lista de mensagens armazenadas >> baixa as mensagens novas >> apaga ou não as mensagens do servidor >> o cliente encerra a conexão.

O POP não possui recursos para alteração de mensagens ou para criar e mover entre pastas.

O protocolo POP atende bem a clientes que farão todo o armazenamento do histórico de mensagens no terminal do usuário, fazendo da caixa no servidor apenas um ponto de passagem temporário.

Com facilidade, podemos analisar a conversa pelo protocolo POP e entender o que aconteceu:
1. A usuária Maria se conectou ao servidor POP e fez sua autenticação (linhas 1 a 5).
2. Em seguida, por meio do comando LIST, foi informada de que duas mensagens estavam presentes em sua caixa de correio (linhas 6 a 10).
3. Leu cada uma delas (comando RETR nas linhas 11 e 17) e as apagou em seguida (comando DELE nas linhas 15 e 21).

#### Características do protocolo IMAP
O protocolo IMAP foi criado para resolver limitações do POP. Com ele, podemos ter um servidor de correio que armazena as mensagens do usuário indefinidamente e permite organizá-las em pastas. Também possui funções avançadas, como pesquisa de mensagens no servidor (busca por endereços, assunto e texto).

O IMAP permite marcar mensagens (lida, não lida, respondida) e prevê o uso simultâneo de diversas caixas de mensagens para o mesmo usuário, sendo possível mover mensagens entre essas caixas. Os clientes de correio costumam exibir essas diversas caixas como uma árvore de pastas ao usuário, facilitando a organização das mensagens. Quando o volume de mensagens armazenadas é muito grande e definitivo, não apenas temporário, esses são recursos essenciais para o usuário, do contrário seria muito difícil encontrar uma mensagem posteriormente.

##### Segurança
Tanto o POP quanto o IMAP podem ser utilizados sem qualquer criptografia. Porém, como já sabemos, essa é uma situação extremamente indesejada, uma vez que o conteúdo e a senha poderão ser capturados. Ambos os protocolos permitem que a comunicação se torne criptografada logo após o estabelecimento da conexão, através do comando **STARTTLS**.

Também é possível que um servidor seja configurado para usar criptografia obrigatória desde o início da conexão. No POP, será usada a porta 995 (POPS) e no IMAP, a porta 993 (IMAPS).

##### Webmail
Atualmente, é muito comum acessar o serviço de correio por meio de um navegador web, o que é conhecido como Webmail. Esse acesso ao servidor Webmail é feito por meio do protocolo HTTP (ou HTTPS).

Quando usamos um Webmail, estamos acessando somente uma página web que se apresenta como um cliente de e-mail. O verdadeiro acesso ao servidor de correio ocorre por trás das cortinas (no chamado backend), invisível para o usuário. No servidor Webmail, um programa acessa nossa caixa de e-mails no servidor de correio e monta uma página com o conteúdo das mensagens.

****
****

## Protocolo DNS
Um dos serviços mais importantes da internet é o DNS (Domain Name System), responsável por traduzir nomes amigáveis em números de endereços.