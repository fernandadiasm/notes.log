---
tags:
  - NETWORKING
curso: Ciência da computação
---
## O protocolo HTTP
A internet começou a se popularizar em 1990 e com isso, era muito comum ver programas de televisão e empresas divulgarem seus sites, que sempre vinham com um formato chamado de *URL - Localizador Uniforme de Recursos*. 

###### exemplo
> http://meusite.com.br
> 
 O URL desse exemplo começa com "**http://**", que indica ao navegador (chrome, firefox, etc) que o acesso deverá ser feito usando o protocolo de aplicação HTTP.

O protocolo HTTP foi criado no início dos anos 1990, como parte de um esforço para simplificar a troca de informações pela internet. Esse esforço rendeu um conjunto de soluções e ferramentas. Foi criada uma linguagem para a formatação de textos e com a possibilidade de navegação entre conteúdos, o chamado **hipertexto**. Essa linguagem recebeu o nome de **HTML**.

Também foi necessário criar *programas para fornecer conteúdos, do lado do servidor (web servers) e para visualizar o conteúdo no computador cliente (browsers ou navegadores). Obviamente, se esses dois programas conversam, foi necessário definir as regras para essa conversa: como devem ser os pedidos e as respostas.* Essas regras são o que chamamos de **protocolo**, e para esse conjunto de soluções foi criado o protocolo **HTTP**.

Uma característica importante do HTTP é que ele permite transmitir diversos tipos de conteúdo, aqui chamados de **objetos**: texto, imagens, vídeos, arquivos em geral.

> O TCP oferece um serviço confiável fim a fim, providenciando a retransmissão de pacotes de dados perdidos ou recebidos com erro. Ainda se encarrega de ajustar o tráfego às condições da rede e das estações participantes. Assim, o protocolo HTTP e as aplicações ficam dispensados de tomar esses cuidados que o TCP proporciona.
> 
> **A porta padronizada para o HTTP é a 80**, sendo possível usar qualquer outra desde que explicitada no URL. A conexão é sempre iniciada pelo cliente (navegador web) ao servidor web.


#### Como ocorrem as interações do protocolo HTTP?
As interações do protocolo HTTP seguem uma sequência: **mensagem de requisição** (pelo cliente) e **mensagem de resposta** (pelo servidor).

![[Pasted image 20240904192437.png]]

Uma característica importante do HTTP é que as requisições e respostas são escritas como um texto comum, usando palavras e expressões do idioma inglês. Isso nos permite olhar a comunicação e entender de imediato o que está acontecendo.

As mensagens de **requisição** seguem o formato:
LINHA DE REQUISIÇÃO
LINHAS DE CABEÇALHO
Linha sem conteúdo
CORPO DA ENTIDADE (nem sempre usado)

A linha de requisição sempre começa com um **método**, que indica a ação que está sendo requisitada. As linhas de cabeçalho podem ser incluídas para carregar informações adicionais na mensagem de requisição. O corpo da entidade é usado quando o cliente precisa enviar dados ao servidor – por exemplo, quando preenchemos um formulário e esses dados estão sendo enviados para o servidor.

```http
GET / HTTP/1.1
Host: meusite.com.br
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:88.0) Gecko/20100101 Firefox/88.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Encoding: gzip, deflate
```

No exemplo anterior, temos na linha de requisição o método GET, usado quando o cliente deseja requisitar algum conteúdo. Ele é seguido pelo recurso que está sendo solicitado. No exemplo, o caractere “/” representa a raiz de um site, ou seja, a página principal. Mas poderia ter sido indicado um nome específico de conteúdo, como uma imagem ou outra página em HTML (/imagem.jpg ou /pagina.html). A linha de requisição termina com a indicação da versão do protocolo HTTP (1.1) que está sendo usada pelo navegador.

O HTTP prevê outros métodos, além do GET. Um deles é o POST, usado quando o cliente precisa enviar dados para o servidor – como exemplificado anteriormente, no caso do preenchimento de um formulário.

Após a linha de requisição, as linhas que seguem são de cabeçalho e carregam informações adicionais à requisição. A primeira delas, muito importante, informa qual o nome do site que está sendo acessado.

Nas demais linhas, o cliente informa qual o programa (agente de usuário) está sendo usado (versão do navegador, sistema operacional), os tipos de conteúdo esperados e as codificações aceitas.

As mensagens de **resposta** seguem o formato:
LINHA DE ESTADO
LINHAS DE CABEÇALHO
Linha sem conteúdo 
CORPO DA ENTIDADE (dados/conteúdo requisitados)

```http
HTTP/1.1 200 OK
Date: Thu, 06 May 2021 17:54:22 GMT
Server: Apache
Last-Modified: Tue, 04 May 2021 14:22:05 GMT
Content-Length: 149495
Content-Type: text/html; charset=UTF-8
(linha sem conteúdo) / Separa o cabeçalho do conteúdo
CONTEÚDO DA RESPOSTA
No caso deste exemplo seria um texto no formato HTML, informação declarada no cabeçalho ‘Content-Type’ acima.
```

A primeira linha (linha de estado) fornece três informações importantes: A  **versão do protocolo HTTP usada**, o **código de estado** (status code) e a **frase explicativa** (reason phrase).

*O código de estado é sempre um número de três dígitos*, que indica o resultado obtido para a requisição. A frase explicativa é um texto voltado para pessoas contendo informações sobre o resultado obtido para a requisição.

#### Códigos de estado
O primeiro dígito do código de estado indica o tipo de resultado obtido, como indicado a seguir:
* **1XX**: Informação. Requisição recebida, ainda sendo processada.
* **2XX**: Sucesso. A requisição foi corretamente recebida e processada.
* **3XX**: Redirecionamento. O cliente deverá tomar outra ação para concluir a requisição.
* **4XX**: Erro do cliente. A requisição é inválida ou não pode ser atendida.
* **5XX**: Erro do servidor. O servidor falhou ao processar uma requisição válida.

Alguns códigos de estado bem conhecidos são:
* **200**: OK. Indicando que o processamento da requisição foi bem-sucedido.
* **404**: Recurso não encontrado. Quando o cliente solicita um recurso que não existe no servidor.
* **500**: Erro interno do servidor. Quando o servidor enfrenta um erro crítico ao processar uma requisição.

#### Entendendo o que há por trás do conteúdo
Quando fazemos uma requisição ao servidor por um recurso, precisamos entender o que pode acontecer em seguida. As duas situações mais comuns são:
* **Conteúdo estático**: O conteúdo está em um arquivo armazenado no servidor, que será enviado ao cliente. Esse conteúdo é chamado de estático, pois ele não é criado ou formatado no momento da requisição. Para mudá-lo, um administrador deve modificar o arquivo no servidor. Nessa categoria estão páginas, imagens, arquivos de formato etc.
* **Conteúdo dinâmico**: Ao receber a requisição, o servidor executará um programa que irá gerar o conteúdo para o cliente. Esse conteúdo é chamado de dinâmico, pois é gerado na hora e pode variar conforme a requisição. É o caso de sites como webmail ou redes sociais, em que o conteúdo é personalizado para quem fez a requisição.

#### HTTP com conexões persistentes
Para aumentar o desempenho, reduzindo o tempo total necessário para baixar os recursos, o protocolo HTTP prevê o modo de operação persistente. Nele, a *conexão TCP permanece ativa após uma resposta, estando pronta para transferir uma nova requisição imediatamente*. A conexão TCP será encerrada quando o cliente não tiver mais requisições a fazer, ou pelo servidor, após um período sem atividade.

![[Pasted image 20240904203217.png]]

#### URL – Uniform Resource Locator
Um URL completo, com todos os dados possíveis, teria um formato assim:

*protocolo://hospedeiro:porta/caminho/recurso*

* **PROTOCOLO**: É o protocolo de aplicação que deverá ser usado para realizar o acesso ao servidor hospedeiro. Por exemplo: http.
* **HOSPEDEIRO**: É o endereço do servidor a ser acessado. Pode ser um endereço IP (IPv4 ou IPv6) ou um nome. No último caso, o navegador deverá realizar a tradução do nome pelo serviço de DNS, antes de iniciar a conexão.
* **PORTA**: É um campo opcional, indicando explicitamente a porta (protocolo TCP) que deverá ser usada. Quando não especificado, é usada a porta padrão do protocolo. No caso do HTTP, a porta padrão é a 80.
* **CAMINHO E RECURSO**: É a localização do recurso no servidor, semelhante a uma estrutura de diretórios, facilitando a organização do conteúdo. O caminho pode ser composto por nenhum ou até por vários nomes.

### HTTPS
Não é tarefa do HTTP garantir a segurança dos dados trafegados. Qualquer pessoa que consiga capturar os pacotes de uma conversa HTTP terá acesso completo aos dados trafegados. O protocolo HTTP não tem recursos para impedir um ataque em que o conteúdo da comunicação é maliciosamente modificado durante seu trânsito, entre origem e destino.

Para resolver essas questões e conferir segurança ao protocolo HTTP, foi criado, em 1994, o HTTPS. Em vez de criar um protocolo, o HTTPS foi definido como **uma extensão do HTTP**, contendo mecanismos para garantir a confidencialidade e a integridade dos dados transmitidos.

![[Pasted image 20240904203651.png]]


#### Mas, como o HTTPS funciona?
A segurança é obtida utilizando mecanismos de criptografia simétrica e assimétrica, e hashing para assinatura digital. O HTTPS também utiliza certificados digitais, assinados por autoridades certificadoras externas. Assim, é possível também impedir que alguém crie um site falso usando o nome ou endereço de alguma empresa ou entidade.

O HTTPS funciona com uma subcamada, abaixo do HTTP, em que todas as informações são protegidas antes de serem enviadas para a camada de transporte; no receptor, a operação inversa é feita nos dados enviados pela camada de transporte. Essa subcamada é composta por um mecanismo SSL (Secure Socker Layer) ou, mais recentemente, TLS (Transport Layer Security).

![[Pasted image 20240904204011.png]]

Fora da subcamada de segurança, a troca de mensagens no HTTPS é exatamente a mesma do HTTP, seguindo as mesmas regras.

****
****
## Protocolo FTP
Antes do HTTP, o principal protocolo para a transferência de arquivos na internet era o FTP. Por ser dedicado à transferência de arquivos, seu funcionamento é diferente em comparação com o HTTP, porém também utiliza o protocolo de transporte TCP.

O FTP trabalha com uma conexão persistente, a conexão de controle, pela qual um usuário interage com o servidor, enviando comandos para navegação entre diretórios, lista seu conteúdo e inicia transferências de arquivo – GET (do servidor para o cliente) e PUT (do cliente para o servidor).

**A porta padrão do servidor FTP para a conexão de controle é a 21.**

#### Conexões do protocolo FTP
Ao estabelecer a conexão de controle, o servidor envia uma saudação com uma mensagem que pode ser personalizada pelo administrador. Em seguida, é necessário se autenticar por meio de login e senha.

Uma vez autenticado o usuário, a conexão de controle permanece ativa. Para qualquer transferência de arquivos, uma nova conexão será iniciada, a **conexão de dados**, que será encerrada imediatamente após o término da transmissão.

![[Pasted image 20240904204606.png]]


##### Uma diferença importante na operação dos protocolos FTP e HTTP é apresentada a seguir:
* **FTP**: Utiliza o **controle fora da banda**, pois separa em conexões distintas os comandos e transferências.
* **HTTP**: Utiliza o **controle na banda**, pois usa a mesma conexão para comandos e transferências.

##### Modos de operação – ativo e passivo
Um ponto importante e que todo profissional de TI deve conhecer, são os dois **modos** para estabelecer as conexões de dados pelo FTP:


| Modo ativo                                                                                                                                                                                                                                                                                                                                                                                                                                       | Modo passivo                                                                                                                                                                                                                                                                                                                                                                        |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| A conexão de dados é iniciada **pelo servidor** ao cliente, com porta de origem 20. Ou seja, para iniciar uma transferência, o cliente deve abrir uma porta e aguardar que o servidor se conecte a ela.<br><br>O grande problema desse modo é que atualmente grande parte dos terminais acessa a internet com tradução de endereço (NAT – Network Address Translation) ou está em redes protegidas por firewalls, que impedem conexões externas. | Nos casos de dificuldade de uso do modo ativo, a solução é utilizar o modo passivo, em que a conexão é iniciada pelo cliente para o servidor em uma porta diferente da porta de controle.<br><br>Para usar o modo passivo, o cliente envia ao servidor, na conexão de controle, o comando PASV e recebe como resposta um endereço IP e porta na qual a conexão deverá ser iniciada. |

![[Pasted image 20240904205011.png]]

****
****

## Protocolo TELNET
**O principal objetivo do protocolo de aplicação TELNET é permitir o acesso remoto a terminais através da internet**. Por meio dele, um usuário pode se conectar a um computador remotamente e ter a mesma experiência que utilizando o terminal desse computador presencialmente.

O TELNET é voltado apenas para terminais baseados em texto, ou seja, transferindo somente dados de caracteres. Logo, o TELNET não permite, por exemplo, acesso a um ambiente gráfico ou o uso de mouse para interação. Essa característica tornou o TELNET uma opção ideal para o acesso a sistemas baseados em texto como o shell, estações baseadas em UNIX e para consoles de gerência de equipamentos de rede, como roteadores, switches etc.

**O TELNET usa a porta 23 como padrão.**
##### Interação com o servidor TELNET
O TELNET utiliza o protocolo de transporte TCP, que garante a confiabilidade na entrega dos pacotes.

O TELNET funciona da seguinte forma:
* Quando um cliente TELNET se conecta a um servidor, é criado um canal de comunicação bidirecional, em que ambos podem enviar e receber dados.
* Como o objetivo do TELNET é oferecer ao usuário uma experiência semelhante ao uso presencial, cada vez que o usuário pressiona uma tecla essa informação é imediatamente enviada ao servidor.
* O cliente não aguarda a digitação de um comando completo para enviá-lo. Na verdade, o cliente não tem conhecimento sobre os comandos digitados ou suas estruturas. Por outro lado, cada informação recebida pelo cliente é imediatamente exibida no terminal do usuário.
* O cliente TELNET sequer exibe no seu próprio terminal as teclas digitadas pelo usuário. Para que isso aconteça, o servidor deverá enviar de volta o texto digitado para o cliente, uma operação chamada ECO. Assim, o servidor tem o controle sobre o que será exibido no terminal do cliente.


O protocolo TELNET não possui mecanismos de autenticação de usuário. Qualquer solicitação de identificação ou senha é transmitida e respondida como um texto comum. Muitos sistemas, apesar de não recomendado, permitiam o acesso ao seu terminal sem autenticação. Nesses casos, o terminal de comandos do servidor estava imediatamente disponível após a conexão do usuário

##### Segurança
Atualmente, o protocolo TELNET está em desuso e é extremamente desaconselhável utilizá-lo na internet. A razão para isso é a falta de segurança. Toda a comunicação é transmitida em texto claro, ou seja, sem qualquer tipo de criptografia que impeça a captura de seus dados, inclusive senhas. A alternativa para acesso remoto atualmente é o protocolo SSH (Secure Shell Protocol), que possui criptografia e autenticação integrada.

****
****

## Protocolos de correio eletrônico
Um dos serviços mais antigos e mais usados na internet é o correio eletrônico (e-mail).  O correio eletrônico é baseado em uma estrutura simples de serviços e protocolos, responsáveis pelas seguintes tarefas: 

RECEPÇÃO >> EFILEIRAMENTO >> ENCAMINHAMENTO >> ARMAZENAMENTO >> RESGATE DE MENSAGENS

### Protocolo SMTP
O próprio formato do endereço de e-mail já nos mostra a estruturação hierárquica do serviço de correio. O endereço é composto de duas partes, separadas pelo caractere @. A segunda parte corresponde ao domínio, enquanto a primeira é a parte local, a identificação do usuário dentro do domínio.

![[Pasted image 20240904210006.png]]


A sequência mais simples de passos ocorre do seguinte modo:

1.  **Cliente se conecta ao servidor**
O cliente de correio do João se conectará ao servidor de correio da sua própria empresa (empresa X). Esse servidor é o responsável por receber as mensagens enviadas pelos endereços da empresa.

2. **Servidor recebe a mensagem**
O servidor da empresa X receberá a mensagem e a armazenará em uma área temporária. Será feita uma análise do destinatário da mensagem. O servidor da empresa X determinará o endereço do servidor de destino, ou seja, da empresa Y.

3. **Conexão entre servidores**
O servidor da empresa X se conectará ao servidor da empresa Y e enviará a mensagem a ele.

4. **Servidor do destino recebe a mensagem**
O servidor da empresa Y receberá a mensagem e a armazenará a mensagem na caixa de mensagens daquele usuário.

![[Pasted image 20240904210226.png]]

Repare que o último item é semelhante a uma caixa de correio física, como usado em muitos prédios. As mensagens recebidas são colocadas nessa caixa e, posteriormente, o destinatário precisará acessar sua caixa para receber o que está ali armazenado.

As etapas 2 e 4 ocorreram nos servidores como tarefas internas. Porém, nas etapas 1 e 3 ocorreu transmissão através da rede. E essas duas etapas têm em comum o protocolo de aplicação usado para a transmissão da mensagem: o **SMTP (Simple Mail Transport Protocol)**.

*O SMTP atua como um agente de transmissão de mensagens (MTA – Mail Transfer Agent), tornando possível o envio da mensagem do remetente, até chegar à caixa postal do destinatário. O protocolo SMTP utiliza o protocolo de transporte TCP, sua porta padrão é a 25 e emprega um modelo cliente-servidor, com a conexão TCP sempre iniciada pelo cliente.*

###### O que precisa ser feito para que a conexão ocorra?
Antes de se conectar ao servidor do destinatário, é preciso determinar qual o endereço IP desse servidor. Para isso, o servidor da empresa X buscará no serviço de DNS o registro do tipo MX do domínio empresay.com.

Uma vez que o endereço foi determinado, o servidor passa à etapa 3. Uma conexão SMTP é iniciada no endereço do servidor de destino.

#### Mensagens do protocolo SMTP
Toda a conversa pelo protocolo SMTP, desde a negociação inicial até o término da transmissão da mensagem, será feita com caracteres de texto. Portanto, assim como vimos no HTTP, se o tráfego for capturado será possível observar com facilidade toda a comunicação.


As respostas do servidor são sempre iniciadas com um código numérico de três dígitos, o status code, semelhante ao HTTP. Resumidamente, se o código de for iniciado com:

* **2XX**: Resposta positiva, a solicitação foi feita com sucesso.
* **3XX**: A solicitação foi recebida com sucesso, porém, aguarda alguma pendência para ser concluída.
* **4XX**: Erro ao processar a solicitação, por uma condição temporária. O cliente deverá repetir a solicitação posteriormente.
* **5XX**: Erro ao processar a solicitação. O cliente **não** deve repetir a solicitação.

Os programas que usam o protocolo SMTP baseiam seu funcionamento somente nas respostas numéricas. O texto posterior serve para auxiliar no diagnóstico de problemas pelos administradores do sistema.

``` SMTP
(01) `S: 220 mailserver.empresay.com ESMTP Postfix`  
(02) `C: EHLO mailserver.empresax.com`  
(03) `S: 250-SIZE 1048576`  
(04) `C: MAIL FROM:<joao@empresaX.com>`  
(05) `S: 250 Ok`  
(06) `C: RCPT TO:<maria@empresaY.com>`  
(07) `S: 250 Ok`  
(08) `C: DATA`  
(09) `S: 354 End data with <CR><LF>.<CR><LF>`  
(10) `C: From: "Joao Silva" <joao@empresax.com>`  
(11) `C: To: “Maria Souza” <maria@empresay.com>`  
(12) `C: Date: Tue, 18 May 2021 12:03:15 -0300`  
(13) `C: Subject: Confirmação`  
(14) `C:``(linha sem conteúdo enviada pelo cliente, para separar cabeçalho do corpo da mensagem)`  
(15) `C: Olá, Maria.`  
(16) `C: Confirmo que recebi seu pedido.`  
(17) `C: Atenciosamente,`  
(18) `C: João.`  
(19) `C: .`  
(20) `S: 250 Ok: queued as 1F8C5A549`  
(21) `C: QUIT`  
(22) `S: 221 Bye`
```

Vamos analisar uma conversa SMTP:
1. Logo após o estabelecimento da conexão TCP, o servidor envia uma saudação, seguindo o código 220 que significa “estou pronto” (linha 1).

2. Em seguida, o cliente se identifica com o comando EHLO. O servidor responde com informações sobre opções ou recursos disponíveis. Nesse exemplo, foi informado somente o tamanho máximo de mensagem aceita pelo servidor. Se a mensagem a ser enviada fosse maior que esse limite, o cliente deveria interromper o envio e reportar ao remetente a impossibilidade de transmissão (linhas 2 e 3).

3.  Continuando, o cliente declara o remetente (MAIL FROM) e os destinatários da mensagem, nesse caso, apenas um destinatário. Se fossem mais destinatários para aquele servidor (@empresay.com), o comando RCPT TO: seria repetido para cada um deles (linhas 4 a 7).

4. Em seguida, o cliente usa o comando DATA para começar o envio da mensagem. O servidor responde que ele deve começar a enviar o conteúdo e sinalizar o término, enviando uma linha apenas com um ponto (linhas 8 e 9).


5. A mensagem é enviada. Repare que ela é dividida em duas partes, separadas por uma linha sem conteúdo (linha 14). A primeira parte, é chamada de CABEÇALHO (linhas 10 a 13). É onde são declaradas as informações daquela mensagem, como remetente, destinatários, cópia aberta, assunto, data e hora do envio etc. A segunda parte é o corpo, que corresponde ao texto da mensagem (linhas 15 a 18).

6. A linha 19 (apenas com um caractere “ponto”) indica o término da mensagem ao servidor.

7. O servidor responde com código 250, para indicar operação bem-sucedida (linha 20).

8. Terminada a transmissão, o cliente envia um comando QUIT e o servidor encerra a conexão TCP (linhas 21 e 22).

O SMTP define que o trecho até a linha 9 é chamado de **envelope**, enquanto o restante é chamado de **conteúdo**.

Nesse exemplo, o RCPT TO: (linha 6) teve respostas com código 250, que indica sucesso da requisição. Se o destinatário estivesse com a caixa de mensagens lotada, o código seria um erro 450, e o cliente deveria tentar o envio posteriormente.

Se o destinatário não existisse, por exemplo, a resposta seria um código 550. Nesse caso, o servidor deveria descartar a mensagem e enviar uma notificação ao remetente. Nas notificações, o texto recebido com o código 550 costuma ser incluído, o que ajuda no diagnóstico do problema.

#### Necessidade de autenticação no protocolo SMTP
Já vimos a transmissão na etapa 3, entre os servidores. Porém, ainda falta falarmos da etapa 1, entre o cliente, no computador de João, e o servidor da empresa X. A conversa com o protocolo SMTP é praticamente a mesma, mas há uma consideração de segurança importante.

O servidor X recebe a mensagem enviada pelo cliente de João e a retransmite para o servidor de destino. Imagine que o servidor X seja plenamente acessível na internet para qualquer usuário, e não somente para quem realmente trabalha na empresa X. Esse servidor seria um alvo fácil para pessoas que desejam transmitir SPAM e para tentativas de golpe usando o servidor da empresa X.

Para isso, foram criadas extensões no protocolo SMTP para exigir a autenticação dos usuários. Alguns dos procedimentos de segurança estão listados a seguir:

* A autenticação é, quase sempre, realizada por meio de senha pessoal.
* O servidor somente retransmitirá uma mensagem para outro servidor se ela tiver sido recebida de um usuário devidamente autenticado.
* O cliente utiliza funções de hashing para enviar a senha ao servidor, impedindo que ela seja interceptada mesmo quando a comunicação não é criptografada.

#### Uso de criptografia com o protocolo SMTP
Atualmente, a grande maioria das comunicações SMTP é feita com o uso de criptografia, protegendo toda a comunicação, inclusive o conteúdo das mensagens, de captura por terceiros.

Sobre isso, a escolha da porta a ser usada depende do tipo de conexão:
* **CLIENTE-SERVIDOR**: Nos dias atuais, é amplamente recomendado que se utilize a porta **587/TCP** para as conexões dos clientes de usuário aos servidores para a transmissão de mensagens, com o uso obrigatório de criptografia e autenticação. A porta 587 é conhecida como **submission port**.
* **SERVIDOR-SERVIDOR**: Entre servidores, é usada somente a porta 25, e se ambos suportarem a camada de segurança TLS (Transport Layer Security), ela poderá oferecer criptografia e segurança por meio de certificados digitais.

#### Cabeçalho Received nos e-mails
Todas as vezes em que uma mensagem é recebida e retransmitida por um servidor de correio, ele inclui uma linha no início do cabeçalho que começa com RECEIVED:. Esse cabeçalho oferece um registro do caminho percorrido pela mensagem, de servidor para servidor, permitindo rastreá-la. Nela, estão incluídas informações sobre cada vez que foi retransmitida, como servidor de origem e destino, data e hora.

### Protocolos POP3 e IMAP – resgatando mensagens no servidor
Até agora, vimos o protocolo SMTP funcionando como um carteiro que entrega uma carta na caixa de correio de uma casa. Porém, para essa carta chegar ao seu destinatário, ele deverá abrir essa caixa e resgatar as cartas armazenadas. No correio eletrônico, essa lógica é a mesma e, para essa função, estudaremos dois protocolos de resgate de mensagens:

*  **POP (Post Office Protocol)**
Porta padrão: 110
Versão mais recente (no momento da confecção deste material): POP3 (terceira versão)

* **IMAP (Internet Message Access Protocol)**
Porta padrão: 143
Versão mais recente (no momento da confecção deste material): IMAP4 (quarta versão)

Os protocolos POP e IMAP também podem ser chamados de agentes de acesso a mensagens (MAA – Mail Agent Access), ambos utilizam o protocolo de transporte TCP.

Assim como você usa uma chave para as caixas de correio de casa, para acessar a sua caixa no servidor será necessária uma autenticação, por meio de senha pessoal. Após a autenticação, o conteúdo fica disponível para ser lido, apagado ou modificado. Mas as semelhanças entre o POP e o IMAP param por aqui.

#### Características do protocolo POP
O POP, mais antigo, tem poucos recursos e se adequava bem às limitações da internet na época em que foi criado. Em linhas gerais, as etapas seguidas são:

O cliente se conecta ao servidor >> o cliente é autenticado >> cliente obtém a lista de mensagens armazenadas >> baixa as mensagens novas >> apaga ou não as mensagens do servidor >> o cliente encerra a conexão.

O POP não possui recursos para alteração de mensagens ou para criar e mover entre pastas.

O protocolo POP atende bem a clientes que farão todo o armazenamento do histórico de mensagens no terminal do usuário, fazendo da caixa no servidor apenas um ponto de passagem temporário.

Com facilidade, podemos analisar a conversa pelo protocolo POP e entender o que aconteceu:
1. A usuária Maria se conectou ao servidor POP e fez sua autenticação (linhas 1 a 5).
2. Em seguida, por meio do comando LIST, foi informada de que duas mensagens estavam presentes em sua caixa de correio (linhas 6 a 10).
3. Leu cada uma delas (comando RETR nas linhas 11 e 17) e as apagou em seguida (comando DELE nas linhas 15 e 21).

#### Características do protocolo IMAP
O protocolo IMAP foi criado para resolver limitações do POP. Com ele, podemos ter um servidor de correio que armazena as mensagens do usuário indefinidamente e permite organizá-las em pastas. Também possui funções avançadas, como pesquisa de mensagens no servidor (busca por endereços, assunto e texto).

O IMAP permite marcar mensagens (lida, não lida, respondida) e prevê o uso simultâneo de diversas caixas de mensagens para o mesmo usuário, sendo possível mover mensagens entre essas caixas. Os clientes de correio costumam exibir essas diversas caixas como uma árvore de pastas ao usuário, facilitando a organização das mensagens. Quando o volume de mensagens armazenadas é muito grande e definitivo, não apenas temporário, esses são recursos essenciais para o usuário, do contrário seria muito difícil encontrar uma mensagem posteriormente.

##### Segurança
Tanto o POP quanto o IMAP podem ser utilizados sem qualquer criptografia. Porém, como já sabemos, essa é uma situação extremamente indesejada, uma vez que o conteúdo e a senha poderão ser capturados. Ambos os protocolos permitem que a comunicação se torne criptografada logo após o estabelecimento da conexão, através do comando **STARTTLS**.

Também é possível que um servidor seja configurado para usar criptografia obrigatória desde o início da conexão. No POP, será usada a porta 995 (POPS) e no IMAP, a porta 993 (IMAPS).

##### Webmail
Atualmente, é muito comum acessar o serviço de correio por meio de um navegador web, o que é conhecido como Webmail. Esse acesso ao servidor Webmail é feito por meio do protocolo HTTP (ou HTTPS).

Quando usamos um Webmail, estamos acessando somente uma página web que se apresenta como um cliente de e-mail. O verdadeiro acesso ao servidor de correio ocorre por trás das cortinas (no chamado backend), invisível para o usuário. No servidor Webmail, um programa acessa nossa caixa de e-mails no servidor de correio e monta uma página com o conteúdo das mensagens.

****
****

## Protocolo DNS
Um dos serviços mais importantes da internet é o DNS (Domain Name System), responsável por traduzir nomes amigáveis em números de endereços.

Se não existir uma forma simplificada de representar os endereços numéricos de cada estação, o uso dessa rede será complexo, desgastante e nada amigável. Por isso, foi desenvolvida uma estrutura para atribuição de nomes de forma hierárquica, permitindo que instituições e empresas tenham o seu domínio de nomes e controle sobre as atribuições dentro desse domínio.

o serviço de DNS faz com que as consultas por nomes possam ser feitas em tempo real, quando fossem necessárias. E, mais importante, de forma distribuída, sem um banco de dados central.

> exemplo: **www.empresax.com**, cada componente de um nome é separado por um ponto.
> exemplo: **webmail.engenharia.empresax.com**, o domínio pode ser ainda subdividido hierarquicamente entre diferentes unidades ou departamentos.

Essa estrutura, chamada de **Name Space**, é estabelecida como uma árvore e cada um dos nós (inclusive as folhas) pode possuir registros (Resource Records). O componente mais à direita é o domínio de topo (TLD – Top Level Domain). O TLD pode ser:

* **Genéricos**: com (para fins comerciais), edu (instituições de ensino), org (organizações sem fins lucrativos).
* **De países**: br (Brasil), ar (Argentina), it (Itália), au (Austrália) – cada país tem sua entidade para definir as regras e gerenciar o TLD.

O elemento responsável por receber e responder consultas por nomes é o **SERVIDOR DNS**.

### Tipos de consulta DNS
Uma das principais configurações de rede de um sistema operacional são os endereços dos servidores de DNS para onde as consultas serão encaminhadas. Geralmente, utilizam-se servidores na rede do próprio provedor ou empresa, pois as respostas tendem a ser mais rápidas.

![[Pasted image 20240924085340.png]]

Esse tipo de consulta é chamado de **recursiva**, pois o cliente pede ao servidor para resolver o nome procurado. Mas para descobrir o endereço procurado, o servidor DNS usará um tipo de consulta chamado de **iterativo**.

##### Como funcionam as consultas?
1. Procuramos o endereço: webmail.engenharia.empresax.com.
2. O servidor DNS que tem a resposta para a nossa pergunta é aquele que tem a **autoridade** sobre o domínio engenharia.empresax.com. Porém, primeiro precisamos descobrir o seu endereço.
3. O servidor de DNS do nosso provedor precisará de um ponto de partida. Ele começará a pesquisa, fazendo a pergunta para um **SERVIDOR RAIZ** (root server). Ao todo, existem 13 servidores raiz, cada um com diversas réplicas espalhadas pelo mundo.
4. O servidor raiz não sabe a resposta para a consulta. Ele não sabe o endereço do nome procurado. Mas ele sabe o endereço do servidor DNS com autoridade sobre o TLD, no caso o “.com”.
5. O nosso servidor DNS, então, entrará em contato com o servidor do TLD, que também não sabe a resposta para a consulta. Mas sabe o endereço do servidor DNS com autoridade sobre o domínio “empresax.com”. Avançando um componente por vez, nosso servidor DNS resolverá o nome que procuramos e só então nos responderá.

![[Pasted image 20240924085601.png]]

Obs: **Em teoria, seria possível fazer toda essa consulta pelo método recursivo, porém, não é utilizado na prática, inclusive por questões de segurança.**

O protocolo DNS pode utilizar as camadas de transporte TCP ou UDP, e o servidor sempre responde na porta 53. A maioria das consultas é realizada com o protocolo UDP, que não exige estabelecimento de conexão, tornando a interação mais ágil. O tamanho máximo da resposta é de 512 bytes (descontando os cabeçalhos UDP e IP). O protocolo TCP é usado quando a resposta ultrapassa o limite de 512 bytes, sendo truncada.

### Os registros DNS (RR – Resource Registry)
O serviço de DNS permite que cada nó da árvore possua zero ou mais registros de recursos. Os principais tipos de registro estão descritos no quadro a seguir:

| Registro de Recursos (RR) | Descrição                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| ------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| A                         | Representa um número de endereço IPv4 (32 bits)                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| AAAA                      | Representa um número de endereço IPv6 (128 bits)                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| CNAME                     | Nome canônico, permite mapear para outro nome. Esse tipo de registro pode ser usado para facilitar a administração de nomes e endereços de servidores.<br><br>Por exemplo, o nome “webmail.enganharia.empresax.com” pode ter um CNAME para “server1821.provedorxpto.com”, onde o serviço está hospedado. Assim, o administrador da zona “empresax.com” não precisa se preocupar em saber o endereço IP do servidor, nem modificar o registro se o “provedorxpto.com” mudar o endereço desse servidor. |
| MX                        | Mail Exchanger. Indica o endereço do servidor para onde e-mails para determinado domínio devem ser encaminhados.                                                                                                                                                                                                                                                                                                                                                                                      |
| NS                        | Name Server. Indica os servidores com autoridade sobre o nome ou domínio consultado.                                                                                                                                                                                                                                                                                                                                                                                                                  |
| SOA                       | Start of Authority. Registro que contém diversas informações administrativas sobre uma zona. Entre elas, configurações para a transferência de zonas entre servidores secundários.                                                                                                                                                                                                                                                                                                                    |
| TXT                       | Permite incluir quaisquer informações, para fins diversos. Costuma ser usado para fins de segurança no envio de e-mails (SPF e DKIM), verificar a titularidade sobre um nome, por exemplo.                                                                                                                                                                                                                                                                                                            |
| PTR                       | Usado para consultas em zona reversa, permitindo consultar o nome associado a um endereço.                                                                                                                                                                                                                                                                                                                                                                                                            |

Um servidor de DNS trabalha basicamente com dois conjuntos de dados:
* **Zonas**: São as bases de dados com todos os domínios para os quais o servidor tem autoridade.
* **Cache**: É o conjunto de registros consultados pelo servidor recentemente, tornando desnecessário repetir consultas. Esses registros são descartados depois de algum tempo, evitando que o cache tenha informações desatualizadas. Esse tempo é definido para cada registro ou domínio, sendo conhecido como TTL (Time to Live).

#### Zonas direta e reversa
O serviço de nomes trabalha com dois tipos de zona:
* **Direta**: A zona direta é a que temos usado até agora como exemplo, em que a árvore representa os domínios e nomes, e os registros podem representar endereços.
* **Reversa**: A zona reversa trabalha ao contrário, permitindo pesquisar por um endereço e obter um nome associado.

Em geral, essas zonas são configuradas por quem tem autoridade sobre um bloco de endereços IP. Para manter a lógica de organização hierárquica, os nomes da pesquisa são formados pelos octetos de um endereço IPv4, na ordem inversa, e com domínio in-addr.arpa.

O Registro PTR associado indicará um nome para o endereço IP. Desse modo, o detentor do bloco 183.27.1/24 pode administrar a zona reversa para o bloco de endereços, criando registros para cada endereço.

Para endereços IPv6, a lógica é a mesma, porém, cada componente do nome é formado por 4 bits (um caractere em representação hexadecimal, de 0 a f), e o domínio é ip6.arpa.

****
****

## Protocolo DHCP
Nos primórdios da internet, cada vez que um dispositivo precisava se conectar a uma rede, o seu administrador era responsável por definir um endereço para ele e configurá-lo manualmente. Esse modo de trabalho tem alguns inconvenientes, como:
 **Necessidade de intervenção manual no dispositivo.**
 **Controle dos endereços alocados a cada dispositivo.**

Mas a pior consequência é a necessidade de alocar um endereço para cada dispositivo que possivelmente se conectará à rede e não aos que estejam efetivamente conectados em dado momento.

Para resolver esses problemas, tornando a conexão do dispositivo algo simples, foi desenvolvido o protocolo DHCP (Dynamic Host Configuration Protocol), ou Protocolo de configuração dinâmica de estações, em tradução livre.

Em resumo, o DHCP é um protocolo que permite a um servidor na rede configurar automaticamente todas as estações que a ele se conectarem.

### Funcionamento do DHCP
O DHCP é baseado na figura do servidor DHCP, elemento central que controla e distribui endereços aos dispositivos conectados.

O algoritmo do protocolo DHCP permite que um cliente se conecte na rede sem qualquer configuração prévia de rede ou servidor. Na prática, a única configuração necessária no dispositivo é para que ele tente obter seu endereço por meio do DHCP, tipicamente uma configuração de fábrica dos principais sistemas operacionais no mercado.

Quando um dispositivo se conecta a uma rede, ele inicia o processo de **descoberta** do protocolo DHCP. Esse processo é feito com um pacote transmitido em **broadcast** na rede, ou seja, recebido por todas as demais estações conectadas na rede.  Apenas o servidor DHCP deve responder a essa solicitação.

![[Pasted image 20240925175407.png]]

Na resposta, o servidor DHCP se identifica e oferece um endereço para uso dessa estação. A negociação continua com o cliente requisitando o uso do endereço IP oferecido e o servidor responde com as informações necessárias para a configuração da rede.

![[Pasted image 20240925175431.png]]


Veja a seguir, os parâmetros dos pacotes DHCP.

|Pacote|Emissor|Endereço de origem|Endereço de destino|Protocolo de transporte|Porta de origem|Porta de destino|
|---|---|---|---|---|---|---|
|DHCPDISCOVER|Cliente|0.0.0.0|255.255.255.255|UDP|68|67|
|DHCPOFFER|Servidor|IP do servidor DHCP|IP oferecido ao cliente|UDP|67|68|
|DHCPREQUEST|Cliente|0.0.0.0|255.255.255.255|UDP|68|67|
|DHCPACK|Servidor|IP do servidor DHCP|IP concedido ao cliente|UDP|67|68|

**O servidor DHCP informa ao cliente o endereço IP que deve ser usado, máscara de rede, endereço de gateway e servidores de DNS.** Também pode ser usado para passar configurações adicionais como servidor para ajustar o relógio.

#### Gerenciamento de endereços
O DHCP foi projetado para funcionar em redes pequenas e grandes, em que há grande volume de dispositivos chegando e saindo. Um dos problemas desse cenário é o esgotamento dos endereços de rede, visto que um endereço é alocado para cada dispositivo. A solução adotada pelo DHCP foi criar um prazo de vida para cada concessão. O dispositivo conectado na rede, continua usando o mesmo endereço, porém, o dispositivo que se desconecta perde a concessão após algum tempo e quando fizer uma nova requisição ao servidor DHCP poderá receber outro endereço.

Esse prazo de vida é chamado de **lease time**, que é definido pelo administrador do servidor DHCP e informado ao cliente no ato da concessão. O cliente deve solicitar a renovação da concessão do endereço após a metade do lease time.

> **Exemplo**
> Se o lease time for de 60 minutos, o cliente deverá solicitar o uso do endereço novamente ao servidor DHCP após 30 minutos.

Após o lease time esgotar, o servidor considera o endereço como livre e pode ser concedido a outros clientes.

O dimensionamento do lease time é uma questão estratégica, que deve levar em consideração a quantidade de endereços disponíveis (o tamanho da rede) e a rotatividade de dispositivos na rede.

Lease time longo: A rede de uma empresa em que os dispositivos são quase sempre os mesmos e eventualmente algum é substituído, pode ter um lease time longo, como de um dia ou uma semana.

Lease time curto: Uma rede de convidados em local movimentado, como em um aeroporto, vai precisar de tempos mais curtos, da ordem de minutos, para evitar que em algum momento todos os endereços estejam alocados para dispositivos, inclusive que já tenham se desconectado da rede.

****
****

## Protocolo SNMP
### Arquitetura SNMP e seus elementos
* **Estação de gerenciamento de rede**: Executam ferramentas de gerenciamento que monitoram e controlam outros equipamentos.
* **Elementos de redes**: Equipamentos, como switches, roteadores, servidores, impressoras, estações de trabalho, gerenciados por meio do agente de gerenciamento.
* **Agente de gerenciamento**: Programas executados nos elementos de rede e que trocam informações com as estações de gerenciamento de rede. Os agentes podem enviar dados sobre o equipamento e alertas em condições especiais.
* **Protocolo de gerenciamento de rede**: Por meio dele, agentes e estações de gerenciamento trocam informações. SNMP (Simple Network Management Protocol), ou protocolo simples de gerenciamento de rede, em tradução livre.
* **Base de informações de gerenciamento**: Os recursos a serem gerenciados são representados como objetos, e a coleção objetos é referenciada como Base de Informações Gerenciais (MIB). 

### Modos de operação do SNMP
A estação de gerenciamento de rede pode buscar as informações sobre um elemento gerenciado por meio das consultas, com o protocolo SNMP. A cada pergunta, a estação coleta dados para o monitoramento sobre um ou mais recursos gerenciados. Por exemplo, pode fazer consultas sobre o uso instantâneo de uma interface de rede, consumo de memória ou temperatura do processador.

Em geral, as consultas são feitas periodicamente pela estação de gerenciamento, um modelo conhecido como **polling**.

![[Pasted image 20240925175957.png]]

O agente de um elemento também pode ser configurado para notificar uma estação de gerenciamento imediatamente após a ocorrência de algum evento. Esse tipo de notificação é chamado de **trap**. Pode ser usado, por exemplo, para notificar uma falha em um componente eletrônico do elemento ou uma tentativa de acesso indevido.

![[Pasted image 20240925180020.png]]

A estratégia de gerenciamento pode combinar os dois mecanismos, aproveitando o melhor de cada um.

Vantagens X desvantagens do polling:

| Vantagem                                                                                                                                                                      | Desvantagem                                                                                                                                                                                                                            |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| A estação de gerenciamento mantém contato periódico com o elemento monitorado, portanto, será capaz de perceber se ela ficar indisponível, parando de responder às consultas. | Gera um tráfego constante de monitoramento, que cresce com a quantidade de elementos monitorados, e o intervalo entre as consultas. A estação de gerenciamento também pode demorar a saber de um evento ocorrido entre duas consultas. |
O trap permite notificar um evento com mais rapidez, porém, como o SNMP utiliza o protocolo de transporte UDP, não há como garantir que o pacote com a notificação foi recebido.

Os agentes escutam a porta 161 para as consultas e enviam traps destinados à porta 162.

****
****


## Sniffer
A ferramenta usada para observar os pacotes trocados entre os hospedeiros é conhecida como **sniffer** de pacotes. Um sniffer captura os pacotes que passam pela interface de rede do computador para armazenar e exibir o conteúdo dos campos dos protocolos que compõem as os pacotes capturados.

![[Pasted image 20240925180502.png]]

No lado direito da imagem estão os protocolos (no caso, protocolos da internet) e aplicativos que normalmente são executados no hospedeiro. O sniffer, mostrado dentro do retângulo tracejado, é uma adição ao software do hospedeiro e consiste em duas partes.

| BIBLIOTECA                                                                                                                                                                                                                                            | ANALISADOR                                                                                                                                                                                                                     |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| A biblioteca de captura de pacotes recebe uma cópia de cada quadro da camada de enlace que é enviado ou recebido pelo hospedeiro. Ela contém todas as mensagens enviadas e recebidas por todos os protocolos e aplicativos em execução no hospedeiro. | O analisador de pacotes exibe os encapsulamentos e o conteúdo de todos os campos dos protocolos presentes. Para fazer isso, o analisador de pacotes deve conhecer a estrutura de todas as mensagens trocadas pelos protocolos. |

Para a análise dos protocolos, utilizaremos o **Wireshark**, que é um analisador de protocolos gratuito executado em computadores Windows, Linux/Unix e Mac. Com ele, podemos analisar todos os protocolos que passam por uma interface de rede, assim como os encasulamentos que ocorrem para a transmissão de dados.

## ATIVIDADES
### ATIVIDADE - HTTP – com Wireshark
Nesta atividade, usaremos o Wireshark para estudar as conexões e os pacotes durante uma troca de mensagens HTTP, com a transferência de arquivos. Para isso, baixe o arquivo com a [captura de pacotes](https://stecine.azureedge.net/repositorio/01907/docs/Captura_HTTP.cap) e abra com o Wireshark ou ative a captura no Wireshark e acesse um site no seu navegador.
![[Captura_HTTP 1.cap]]

Agora, analisaremos algumas informações da troca de mensagens realizada na captura que foi disponibilizada.

![[Pasted image 20240925180833.png]]
![[Pasted image 20240925180844.png]]
![[Pasted image 20240925180906.png]]




### ATIVIDADE - HTTP – com ferramenta de desenvolvedor
Os principais navegadores possuem uma ferramenta para desenvolvedores, que permite analisar em detalhes todos os aspectos de um site, desde as conexões na rede até sua composição visual.

Essa ferramenta é ideal para analisar conexões de HTTPS, uma vez que ela nos mostrará as requisições, respostas, os cabeçalhos e conteúdo sem criptografia, permitindo a sua análise. Abra o seu navegador (preferencialmente Google Chrome, Mozilla Firefox ou Microsoft Edge) e pressione a tecla F12 (dependendo do navegador pode variar). Selecione a aba “Rede” (Network).

![](https://stecine.azureedge.net/repositorio/01907/img/img29.jpg)

Indicação da opção de análise do tráfego de “REDE” na ferramenta de desenvolvedor. Capturado do Google Chrome

Após abrir a aba, acesse um site, de sua preferência. Observe as linhas se preenchendo, uma para cada requisição.

![](https://stecine.azureedge.net/repositorio/01907/img/img30.jpg)

Exemplo do conteúdo exibido pela ferramenta do desenvolvedor após captura de tráfego. Capturado do Google Chrome

Selecione uma requisição e observe na janela ao lado os detalhes das requisições e respectivas respostas. Alguns navegadores têm a opção **Bruto**, que permite visualizar o cabeçalho no formato original.

![](https://stecine.azureedge.net/repositorio/01907/img/img31.jpg)

Exemplo de cabeçalho extraído de tráfego HTTP pela ferramenta de desenvolvedor. Capturado do Google Chrome

Analise os dados exibidos pela ferramenta e procure responder as seguintes questões:
1) Quantas requisições, ao todo, foram realizadas?
2) Quais foram os códigos de estado para as requisições? Alguma apresentou código de erro? Por quê?
3) Quais tipos de recursos foram obtidos pelo navegador?
4) Acesse um site que disponibilize um campo para preenchimento. Pode ser um campo de pesquisa ou login e senha. Analise os dados obtidos pela ferramenta ao enviar. Busque entre as requisições, aquela com método POST.

### ATIVIDADE - FTP
Nesta atividade, usaremos o Wireshark para estudar as conexões e os pacotes durante uma sessão FTP, com a transferência de arquivos. Baixe o arquivo com a [captura de pacotes](https://stecine.azureedge.net/repositorio/01907/docs/Captura_FTP.pcap).

Agora, analisaremos algumas informações da troca de mensagens realizada na captura que foi disponibilizada.

Novamente, utilize o filtro “tcp.flags.syn==1 && tcp.flags.ack==0” para que o Wireshark mostre somente o primeiro pacote de cada conexão TCP (Flag SYN=1 e ACK=0). Ao todo, quantas conexões TCP foram feitas entre o cliente e o servidor?

![](https://stecine.azureedge.net/repositorio/01907/img/img32.jpg)

Filtre agora pelo protocolo FTP. Qual o objetivo da segunda conexão TCP? Que dados foram transferidos?

![](https://stecine.azureedge.net/repositorio/01907/img/img33.jpg)

Agora, siga as etapas adiante:

Verifique o arquivo e veja quais arquivos foram transferidos. Quantos foram upload e quantos foram download?

Verifique se o protocolo estava operando no modo ativo ou passivo.

Considerando que o FTP não utiliza criptografia, você consegue identificar o login e a senha usados para acesso ao servidor?


### ATIVIDADE -  TELNET

Nesta atividade, estudaremos um arquivo de captura com um acesso ao serviço TELNET.

### **Cliente: 192.168.1.70**

### **Servidor: 192.168.1.64**

A tela de toda a sessão foi gravada e está copiada abaixo. Os textos em azul foram enviados do servidor para o cliente, enquanto os textos em vermelho foram enviados do cliente para o servidor.
`***************************************`  
`* Servidor de Testes *`  
`* *`  
`* Acesso restrito a administradores *`  
`***************************************`  
`servidor login:` `admin`  
`Password:`  
`Welcome to Ubuntu 20.04 LTS (GNU/Linux 5.4.0-31-generic x86_64)`  
`* Documentation: https://help.ubuntu.com`  
`* Management: https://landscape.canonical.com`  
`* Support: https://ubuntu.com/advantage`  
`* MicroK8s passes 9 million downloads. Thank you to all our contributors!`  
`https://microk8s.io/`  
`11 updates can be installed immediately.`  
`0 of these updates are security updates.`  
`To see these additional updates run: apt list --upgradable`  
`Last login: Sat May 15 16:21:06 UTC 2021 from 192.168.1.70 on pts/0`  
`To run a command as administrator (user "root"), use "sudo ".`  
`See "man sudo_root" for details.`  
`admin@servidor:~$` `ls /tmp`  
`snap.lxd`  
`systemd-private-4dd24f00a8634850966e9e9bf3e20647-fwupd.service-cso5Lh`  
`systemd-private-4dd24f00a8634850966e9e9bf3e20647-systemd-logind.service-gcwmKh`  
`systemd-private-4dd24f00a8634850966e9e9bf3e20647-systemd-resolved.service-XLdZxi`  
`systemd-private-4dd24f00a8634850966e9e9bf3e20647-systemd-timesyncd.service-USIYZi`  
`admin@servidor:~$` `cp /etc/lsb-release .`  
`admin@servidor:~$` `cat lsb-release`  
`DISTRIB_ID=Ubuntu`  
`DISTRIB_RELEASE=20.04`  
`DISTRIB_CODENAME=focal`  
`DISTRIB_DESCRIPTION="Ubuntu 20.04 LTS"`  
`admin@servidor:~$` `exit`  

Baixe o arquivo com a [captura de pacotes](https://stecine.azureedge.net/repositorio/01907/docs/Captura_TELNET.cap) e para reconstruir toda a comunicação pelo protocolo TELNET, clique sobre um dos pacotes com o botão direito e selecione “Follow → ‘TCP Stream’. Repare que o protocolo não usa qualquer tipo de criptografia e todo o conteúdo da comunicação está visível.

Agora, analisaremos algumas informações da troca de mensagens realizada na captura que foi disponibilizada.

Utilizando as ferramentas de estatísticas do Wireshark, verifique a quantidade de pacotes por faixa de tamanho. No menu, clique em ‘Statistics’ → ‘Packet Lenghts’.

Será gerada a tela a seguir. Na primeira coluna, são indicadas faixas de tamanho dos pacotes; e na segunda coluna, a contagem de pacotes em cada faixa.

![](https://stecine.azureedge.net/repositorio/01907/img/img34.jpg)

**Por que a maioria dos pacotes (cerca de 96%) tem tamanho reduzido, entre 40 e 79 bytes? Qual característica do protocolo leva a esse comportamento?**

Ao analisar a captura é possível perceber muitos pacotes em pares, sendo um em cada sentido, e de tamanho reduzido, às vezes, com apenas 1 byte transportado.

![](https://stecine.azureedge.net/repositorio/01907/img/img35.jpg)


**Qual a causa desse efeito? Qual o teor desse conteúdo?**

### ATIVIDADE - SMTP
Nesta atividade, usaremos o Wireshark para estudar as conexões e os pacotes durante uma sessão SMTP. Baixe o arquivo com a [captura de pacotes](https://stecine.azureedge.net/repositorio/01907/docs/Captura_SMTP.pcap).

Agora, analisaremos algumas informações da troca de mensagens realizada na captura que foi disponibilizada. Digite SMTP no filtro para analisar as questões.

A conexão SMTP presente foi de um cliente de correio para um servidor ou entre dois servidores de correio eletrônico? Como é possível afirmar isso?

Analise as informações e identifique qual é o remetente da mensagem.

Qual(is) é(são) o(s) destinatário(s) da mensagem?

Você consegue identificar qual é o assunto da mensagem?

### ATIVIDADE - DNS

Nesta atividade, estudaremos o protocolo DNS usando duas ferramentas. A primeira é o nslookup. Trata-se de um cliente DNS, já instalado nos principais sistemas operacionais, que nos permite fazer consultas diretamente a servidores DNS e observar sua resposta. Em paralelo, usaremos o Wireshark para capturar o tráfego gerado pelo nslookup e depois analisar seus pacotes.

Para fazer essa atividade, inicie a captura com o programa Wireshark. Execute o programa nslookup. No Windows digite “nslookup” no menu iniciar ou no Prompt de comandos. No nslookup, digite os comandos a seguir e observe as respostas:

- server 8.8.8.8 → O servidor DNS para onde as consultas serão enviadas.
- set type=a → Pesquisar por registros de tipo A (endereço IPv4).
- google.com → Pesquisar esse nome.
- set type=aaaa → Pesquisar por registros de tipo AAAA (endereço IPv6).
- google.com → Pesquisar esse nome.
- set type=any → Pesquisar por todos os tipos de registro.
- microsoft.com → Pesquisar esse nome.
- exit → Sair do programa.

Interrompa a captura do Wireshark e filtre pelo protocolo DNS.

Se preferir, você pode baixar a [captura de pacotes](https://stecine.azureedge.net/repositorio/01907/docs/Captura_DNS.pcapng) utilizada na atividade. A captura será semelhante a imagem a seguir.

![](https://stecine.azureedge.net/repositorio/01907/img/img36.jpg)

Agora, analisaremos algumas informações da troca de mensagens realizada na captura que foi disponibilizada.

Analise as informações e identifique quais os endereços do nome ‘google.com’ (IPv4 e IPv6).

Observe os pacotes capturados e relacione as consultas e respectivas respostas.

Encontre nos pacotes de consulta (queries) as informações solicitadas ao servidor.

Encontre nos pacotes de resposta (answers) as informações exibidas pelo nslookup.

As consultas foram realizadas com protocolo de transporte UDP ou TCP? Se o TCP foi usado, identifique o motivo.

### ATIVIDADE - DHCP

Nesta atividade, analisaremos os pacotes trocados entre cliente e servidor DHCP para obter uma concessão (lease) de endereço.

Para realizar a atividade, inicie a captura com o programa Wireshark. Utilizando o Windows, abra o Prompt de comandos e digite os seguintes comandos:

- ipconfig /release → Liberar (“esquecer”) a atual concessão DHCP.
- ipconfig /renew → Obter uma nova concessão.
- ipconfig → Exibir a configuração de rede obtida.

Agora, interrompa a captura com o programa Wireshark e filtre os pacotes, utilizando a expressão dhcp.

**Observe que o primeiro pacote capturado foi o DHCPRELEASE (quando foi digitado o primeiro comando). Ignore esse pacote nesta atividade.**

Se preferir, você pode baixar a [captura de pacotes](https://stecine.azureedge.net/repositorio/01907/docs/Captura_DHCP.pcapng).

Agora, analisaremos algumas informações da troca de mensagens realizada na captura que foi disponibilizada.

Identifique quantos pacotes foram trocados entre cliente e servidor DHCP.

Para cada pacote, observe os endereços e as portas de origem e destino e compare com a tabela apresentada no módulo 3.

Encontre nos pacotes de resposta do servidor os parâmetros de configuração da rede (endereço concedido, máscara de rede, gateway padrão e servidor(es) de DNS).

Qual o tempo da concessão (lease time)?